<!doctype html>
<head><meta charset="utf-8">
<script src="ecmarkup.js"></script>
<link rel="stylesheet" href="ecmarkup.css">
<title>Module attributes</title>
<script type="application/json" id="menu-search-biblio">[{"type":"clause","id":"intro","aoid":null,"title":"Module attributes","titleHTML":"Module attributes","number":"","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":[],"key":"Module attributes"},{"type":"production","id":"prod-ImportDeclaration","name":"ImportDeclaration","referencingIds":[],"namespace":"https://github.com/tc39/proposal-module-attributes","location":"","key":"ImportDeclaration"},{"type":"production","id":"prod-WithClause","name":"WithClause","referencingIds":["_ref_71","_ref_72","_ref_75"],"namespace":"https://github.com/tc39/proposal-module-attributes","location":"","key":"WithClause"},{"type":"production","id":"prod-WithList","name":"WithList","referencingIds":["_ref_73","_ref_74"],"namespace":"https://github.com/tc39/proposal-module-attributes","location":"","key":"WithList"},{"type":"production","id":"prod-ImportCall","name":"ImportCall","referencingIds":["_ref_76"],"namespace":"https://github.com/tc39/proposal-module-attributes","location":"","key":"ImportCall"},{"type":"clause","id":"sec-syntax","aoid":null,"title":"Syntax","titleHTML":"Syntax","number":"1","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":[],"key":"Syntax"},{"type":"clause","id":"sec-import-call-runtime-semantics-evaluation","aoid":null,"title":"Runtime Semantics: Evaluation","titleHTML":"Runtime Semantics: Evaluation","number":"2.1.1","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":[],"key":"Runtime Semantics: Evaluation"},{"type":"clause","id":"sec-import-calls","aoid":null,"title":"Import Calls","titleHTML":"Import Calls","number":"2.1","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":["_ref_0","_ref_1","_ref_2","_ref_3"],"key":"Import Calls"},{"type":"op","aoid":"HostResolveImportedModule","refId":"sec-hostresolveimportedmodule","location":"","referencingIds":[],"key":"HostResolveImportedModule"},{"type":"clause","id":"sec-hostresolveimportedmodule","aoid":"HostResolveImportedModule","title":"Runtime Semantics: HostResolveImportedModule ( referencingScriptOrModule, specifier, attributes )","titleHTML":"Runtime Semantics: HostResolveImportedModule ( <var>referencingScriptOrModule</var>, <var>specifier</var><ins>, <var>attributes</var></ins> )","number":"2.2","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":["_ref_24","_ref_26","_ref_30","_ref_31","_ref_34","_ref_66","_ref_67","_ref_68"],"key":"Runtime Semantics: HostResolveImportedModule ( referencingScriptOrModule, specifier, attributes )"},{"type":"op","aoid":"HostImportModuleDynamically","refId":"sec-hostimportmoduledynamically","location":"","referencingIds":[],"key":"HostImportModuleDynamically"},{"type":"clause","id":"sec-hostimportmoduledynamically","aoid":"HostImportModuleDynamically","title":"Runtime Semantics: HostImportModuleDynamically ( referencingScriptOrModule, specifier,  attributes, promiseCapability )","titleHTML":"Runtime Semantics: HostImportModuleDynamically ( <var>referencingScriptOrModule</var>, <var>specifier</var>,  <ins><var>attributes</var>,</ins> <var>promiseCapability</var> )","number":"2.3","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":["_ref_10","_ref_18","_ref_32","_ref_69"],"key":"Runtime Semantics: HostImportModuleDynamically ( referencingScriptOrModule, specifier,  attributes, promiseCapability )"},{"type":"op","aoid":"FinishDynamicImport","refId":"sec-finishdynamicimport","location":"","referencingIds":[],"key":"FinishDynamicImport"},{"type":"clause","id":"sec-finishdynamicimport","aoid":"FinishDynamicImport","title":"Runtime Semantics: FinishDynamicImport ( referencingScriptOrModule, specifier,  attributes, promiseCapability, completion )","titleHTML":"Runtime Semantics: FinishDynamicImport ( <var>referencingScriptOrModule</var>, <var>specifier</var>,  <ins><var>attributes</var>,</ins> <var>promiseCapability</var>, <var>completion</var> )","number":"2.4","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":["_ref_21","_ref_22","_ref_25","_ref_27","_ref_28","_ref_29"],"key":"Runtime Semantics: FinishDynamicImport ( referencingScriptOrModule, specifier,  attributes, promiseCapability, completion )"},{"type":"term","term":"Synthetic Module Record","refId":"sec-synthetic-module-records","referencingIds":[],"namespace":"https://github.com/tc39/proposal-module-attributes","location":"","key":"Synthetic Module Record"},{"type":"table","id":"table-synthetic-module-record-fields","number":1,"caption":"Table 1: Additional Fields of Synthetic Module Records","referencingIds":["_ref_4"],"namespace":"https://github.com/tc39/proposal-module-attributes","location":"","key":"Table 1: Additional Fields of Synthetic Module Records"},{"type":"op","aoid":"CreateSyntheticModule","refId":"sec-createsyntheticmodule","location":"","referencingIds":[],"key":"CreateSyntheticModule"},{"type":"clause","id":"sec-createsyntheticmodule","aoid":"CreateSyntheticModule","title":"CreateSyntheticModule ( exportNames, evaluationSteps, realm, hostDefined )","titleHTML":"CreateSyntheticModule ( <var>exportNames</var>, <var>evaluationSteps</var>, <var>realm</var>, <var>hostDefined</var> )","number":"2.5.1","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":["_ref_38","_ref_40","_ref_60"],"key":"CreateSyntheticModule ( exportNames, evaluationSteps, realm, hostDefined )"},{"type":"op","aoid":"SetSyntheticModuleExport","refId":"sec-setsyntheticmoduleexport","location":"","referencingIds":[],"key":"SetSyntheticModuleExport"},{"type":"clause","id":"sec-setsyntheticmoduleexport","aoid":"SetSyntheticModuleExport","title":"SetSyntheticModuleExport ( module, exportName, exportValue )","titleHTML":"SetSyntheticModuleExport ( <var>module</var>, <var>exportName</var>, <var>exportValue</var> )","number":"2.5.2","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":["_ref_39","_ref_42","_ref_61"],"key":"SetSyntheticModuleExport ( module, exportName, exportValue )"},{"type":"clause","id":"sec-smr-getexportednames","aoid":null,"title":"GetExportedNames( exportStarSet )","titleHTML":"GetExportedNames( <var>exportStarSet</var> )","number":"2.5.3.1","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":[],"key":"GetExportedNames( exportStarSet )"},{"type":"clause","id":"sec-smr-resolveexport","aoid":null,"title":"ResolveExport( exportName, resolveSet )","titleHTML":"ResolveExport( <var>exportName</var>, <var>resolveSet</var> )","number":"2.5.3.2","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":[],"key":"ResolveExport( exportName, resolveSet )"},{"type":"clause","id":"sec-smr-instantiate","aoid":null,"title":"Instantiate ( )","titleHTML":"Instantiate ( )","number":"2.5.3.3","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":[],"key":"Instantiate ( )"},{"type":"clause","id":"sec-smr-Evaluate","aoid":null,"title":"Evaluate ( )","titleHTML":"Evaluate ( )","number":"2.5.3.4","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":[],"key":"Evaluate ( )"},{"type":"clause","id":"sec-smr-concrete-methods","aoid":null,"title":"Concrete Methods","titleHTML":"Concrete Methods","number":"2.5.3","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":[],"key":"Concrete Methods"},{"type":"clause","id":"sec-synthetic-module-records","aoid":null,"title":"Synthetic Module Records","titleHTML":"Synthetic Module Records","number":"2.5","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":["_ref_41","_ref_43","_ref_44","_ref_45","_ref_46","_ref_47","_ref_48","_ref_49","_ref_50","_ref_51","_ref_52","_ref_54","_ref_55","_ref_59"],"key":"Synthetic Module Records"},{"type":"op","aoid":"CreateDefaultExportSyntheticModule","refId":"sec-create-default-export-synthetic-module","location":"","referencingIds":[],"key":"CreateDefaultExportSyntheticModule"},{"type":"clause","id":"sec-create-default-export-synthetic-module","aoid":"CreateDefaultExportSyntheticModule","title":"CreateDefaultExportSyntheticModule ( defaultExport )","titleHTML":"CreateDefaultExportSyntheticModule ( <var>defaultExport</var> )","number":"2.6","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":["_ref_63"],"key":"CreateDefaultExportSyntheticModule ( defaultExport )"},{"type":"op","aoid":"ParseJSONModule","refId":"sec-parse-json-module","location":"","referencingIds":[],"key":"ParseJSONModule"},{"type":"clause","id":"sec-parse-json-module","aoid":"ParseJSONModule","title":"ParseJSONModule ( source )","titleHTML":"ParseJSONModule ( <var>source</var> )","number":"2.7","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":["_ref_20"],"key":"ParseJSONModule ( source )"},{"type":"clause","id":"sec-semantics","aoid":null,"title":"Semantics","titleHTML":"Semantics","number":"2","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":[],"key":"Semantics"},{"type":"clause","id":"sec-host-integration","aoid":null,"title":"Sample host integration: The Web embedding","titleHTML":"Sample host integration: The Web embedding","number":"A","namespace":"https://github.com/tc39/proposal-module-attributes","location":"","referencingIds":[],"key":"Sample host integration: The Web embedding"}]</script></head><body><div id="menu-toggle">☰</div><div id="menu-spacer"></div><div id="menu"><div id="menu-search"><input type="text" id="menu-search-box" placeholder="Search..."><div id="menu-search-results" class="inactive"></div></div><div id="menu-pins"><div class="menu-pane-header">Pins</div><ul id="menu-pins-list"></ul></div><div class="menu-pane-header">Table of Contents</div><div id="menu-toc"><ol class="toc"><li><span class="item-toggle-none"></span><a href="#intro" title="Module attributes">Module attributes</a></li><li><span class="item-toggle-none"></span><a href="#sec-syntax" title="Syntax"><span class="secnum">1</span> Syntax</a></li><li><span class="item-toggle">◢</span><a href="#sec-semantics" title="Semantics"><span class="secnum">2</span> Semantics</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-import-calls" title="Import Calls"><span class="secnum">2.1</span> Import Calls</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-import-call-runtime-semantics-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">2.1.1</span> RS: Evaluation</a></li></ol></li><li><span class="item-toggle-none"></span><a href="#sec-hostresolveimportedmodule" title="Runtime Semantics: HostResolveImportedModule ( referencingScriptOrModule, specifier, attributes )"><span class="secnum">2.2</span> RS: HostResolveImportedModule ( <var>referencingScriptOrModule</var>, <var>specifier</var><ins>, <var>attributes</var></ins> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-hostimportmoduledynamically" title="Runtime Semantics: HostImportModuleDynamically ( referencingScriptOrModule, specifier,  attributes, promiseCapability )"><span class="secnum">2.3</span> RS: HostImportModuleDynamically ( <var>referencingScriptOrModule</var>, <var>specifier</var>,  <ins><var>attributes</var>,</ins> <var>promiseCapability</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-finishdynamicimport" title="Runtime Semantics: FinishDynamicImport ( referencingScriptOrModule, specifier,  attributes, promiseCapability, completion )"><span class="secnum">2.4</span> RS: FinishDynamicImport ( <var>referencingScriptOrModule</var>, <var>specifier</var>,  <ins><var>attributes</var>,</ins> <var>promiseCapability</var>, <var>completion</var> )</a></li><li><span class="item-toggle">◢</span><a href="#sec-synthetic-module-records" title="Synthetic Module Records"><span class="secnum">2.5</span> Synthetic Module Records</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-createsyntheticmodule" title="CreateSyntheticModule ( exportNames, evaluationSteps, realm, hostDefined )"><span class="secnum">2.5.1</span> CreateSyntheticModule ( <var>exportNames</var>, <var>evaluationSteps</var>, <var>realm</var>, <var>hostDefined</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-setsyntheticmoduleexport" title="SetSyntheticModuleExport ( module, exportName, exportValue )"><span class="secnum">2.5.2</span> SetSyntheticModuleExport ( <var>module</var>, <var>exportName</var>, <var>exportValue</var> )</a></li><li><span class="item-toggle">◢</span><a href="#sec-smr-concrete-methods" title="Concrete Methods"><span class="secnum">2.5.3</span> Concrete Methods</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-smr-getexportednames" title="GetExportedNames( exportStarSet )"><span class="secnum">2.5.3.1</span> GetExportedNames( <var>exportStarSet</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-smr-resolveexport" title="ResolveExport( exportName, resolveSet )"><span class="secnum">2.5.3.2</span> ResolveExport( <var>exportName</var>, <var>resolveSet</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-smr-instantiate" title="Instantiate ( )"><span class="secnum">2.5.3.3</span> Instantiate ( )</a></li><li><span class="item-toggle-none"></span><a href="#sec-smr-Evaluate" title="Evaluate ( )"><span class="secnum">2.5.3.4</span> Evaluate ( )</a></li></ol></li></ol></li><li><span class="item-toggle-none"></span><a href="#sec-create-default-export-synthetic-module" title="CreateDefaultExportSyntheticModule ( defaultExport )"><span class="secnum">2.6</span> CreateDefaultExportSyntheticModule ( <var>defaultExport</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-parse-json-module" title="ParseJSONModule ( source )"><span class="secnum">2.7</span> ParseJSONModule ( <var>source</var> )</a></li></ol></li><li><span class="item-toggle-none"></span><a href="#sec-host-integration" title="Sample host integration: The Web embedding"><span class="secnum">A</span> Sample host integration: The Web embedding</a></li></ol></div></div><div id="spec-container"><h1 class="version first">Stage 1 Draft / May 11, 2020</h1>
<emu-intro id="intro">
  <h1>Module attributes</h1>
  <p>See  <a href="https://github.com/tc39/proposal-module-attributes/blob/master/README.md">the explainer</a> for information.</p>
</emu-intro>

<emu-clause id="sec-syntax">
  <h1><span class="secnum">1</span> Syntax</h1>

  <emu-grammar><emu-production name="ImportDeclaration" id="prod-ImportDeclaration">
    <emu-nt><a href="#prod-ImportDeclaration">ImportDeclaration</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="1a51d4c5"><emu-t>import</emu-t><emu-nt><a href="https://tc39.es/ecma262/#prod-ImportClause">ImportClause</a></emu-nt><emu-nt><a href="https://tc39.es/ecma262/#prod-FromClause">FromClause</a></emu-nt><emu-t>;</emu-t></emu-rhs>
    <emu-rhs a="a1d094cc"><emu-t>import</emu-t><emu-nt><a href="https://tc39.es/ecma262/#prod-ModuleSpecifier">ModuleSpecifier</a></emu-nt><emu-t>;</emu-t></emu-rhs>
    <ins><emu-rhs a="7c5acfdd"><emu-t>import</emu-t><emu-nt><a href="https://tc39.es/ecma262/#prod-ImportClause">ImportClause</a></emu-nt><emu-nt><a href="https://tc39.es/ecma262/#prod-FromClause">FromClause</a></emu-nt><emu-nt id="_ref_71"><a href="#prod-WithClause">WithClause</a></emu-nt><emu-t>;</emu-t></emu-rhs></ins>
    <ins><emu-rhs a="2af8d0e5"><emu-t>import</emu-t><emu-nt><a href="https://tc39.es/ecma262/#prod-ModuleSpecifier">ModuleSpecifier</a></emu-nt><emu-nt id="_ref_72"><a href="#prod-WithClause">WithClause</a></emu-nt><emu-t>;</emu-t></emu-rhs></ins>
</emu-production>
<emu-production name="WithClause" id="prod-WithClause">
    <emu-nt><a href="#prod-WithClause">WithClause</a></emu-nt><emu-geq>:</emu-geq><ins><emu-rhs a="4a3da9f4"><emu-t>with</emu-t><emu-nt id="_ref_73"><a href="#prod-WithList">WithList</a></emu-nt></emu-rhs>
    </ins>
</emu-production>
<emu-production name="WithList" id="prod-WithList">
    <emu-nt><a href="#prod-WithList">WithList</a></emu-nt><emu-geq>:</emu-geq><ins><emu-rhs a="3e65d48a"><emu-nt><a href="https://tc39.es/ecma262/#prod-IdentifierName">IdentifierName</a></emu-nt><emu-t>:</emu-t><emu-nt><a href="https://tc39.es/ecma262/#prod-StringLiteral">StringLiteral</a></emu-nt></emu-rhs></ins>
    <ins><emu-rhs a="75896a6e"><emu-nt><a href="https://tc39.es/ecma262/#prod-IdentifierName">IdentifierName</a></emu-nt><emu-t>:</emu-t><emu-nt><a href="https://tc39.es/ecma262/#prod-StringLiteral">StringLiteral</a></emu-nt><emu-t>,</emu-t><emu-nt id="_ref_74"><a href="#prod-WithList">WithList</a></emu-nt></emu-rhs></ins>
</emu-production>
<emu-production name="ImportCall" params="Yield, Await" id="prod-ImportCall">
    <emu-nt params="Yield, Await"><a href="#prod-ImportCall">ImportCall</a><emu-mods><emu-params>[Yield, Await]</emu-params></emu-mods></emu-nt><emu-geq>:</emu-geq><emu-rhs a="9710d64c"><emu-t>import</emu-t><emu-t>(</emu-t><emu-nt params="+In, ?Yield, ?Await"><a href="https://tc39.es/ecma262/#prod-AssignmentExpression">AssignmentExpression</a><emu-mods><emu-params>[+In, ?Yield, ?Await]</emu-params></emu-mods></emu-nt><emu-t optional="">,<emu-mods><emu-opt>opt</emu-opt></emu-mods></emu-t><emu-t>)</emu-t></emu-rhs>
    <ins><emu-rhs a="571c9520"><emu-t>import</emu-t><emu-t>(</emu-t><emu-nt params="+In, ?Yield, ?Await"><a href="https://tc39.es/ecma262/#prod-AssignmentExpression">AssignmentExpression</a><emu-mods><emu-params>[+In, ?Yield, ?Await]</emu-params></emu-mods></emu-nt><emu-t>,</emu-t><emu-nt params="+In, ?Yield, ?Await"><a href="https://tc39.es/ecma262/#prod-AssignmentExpression">AssignmentExpression</a><emu-mods><emu-params>[+In, ?Yield, ?Await]</emu-params></emu-mods></emu-nt><emu-t optional="">,<emu-mods><emu-opt>opt</emu-opt></emu-mods></emu-t><emu-t>)</emu-t></emu-rhs></ins>
</emu-production></emu-grammar>
</emu-clause>

<emu-clause id="sec-semantics">
  <h1><span class="secnum">2</span> Semantics</h1>

  <emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents"><p>Many productions operating on grammar are the same whether or not an <emu-nt id="_ref_75"><a href="#prod-WithClause">WithClause</a></emu-nt>/second <emu-nt id="_ref_76"><a href="#prod-ImportCall">ImportCall</a></emu-nt> parameter is included; the new parameter is ignored. In this section, only the semantically significant changes are included, and the PR to merge into the main specification would fill in the straightforward details.</p></div></emu-note>

    <emu-clause id="sec-import-calls">
      <h1><span class="secnum">2.1</span> Import Calls</h1>

      <emu-clause id="sec-import-call-runtime-semantics-evaluation">
        <h1><span class="secnum">2.1.1</span> Runtime Semantics: Evaluation</h1>

        <emu-grammar><emu-production name="ImportCall" collapsed="">
    <emu-nt><a href="#prod-ImportCall">ImportCall</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="44ab2e9a"><emu-t>import</emu-t><emu-t>(</emu-t><emu-nt><a href="https://tc39.es/ecma262/#prod-AssignmentExpression">AssignmentExpression</a></emu-nt><emu-t optional="">,<emu-mods><emu-opt>opt</emu-opt></emu-mods></emu-t><emu-t>)</emu-t></emu-rhs>
</emu-production></emu-grammar>
        <emu-alg><ol><li>Let <var>referencingScriptOrModule</var> be !&nbsp;<emu-xref aoid="GetActiveScriptOrModule" id="_ref_5"><a href="https://tc39.es/ecma262/#sec-getactivescriptormodule">GetActiveScriptOrModule</a></emu-xref>().</li><li>Let <var>argRef</var> be the result of evaluating <emu-nt><a href="https://tc39.es/ecma262/#prod-AssignmentExpression">AssignmentExpression</a></emu-nt>.</li><li>Let <var>specifier</var> be ?&nbsp;<emu-xref aoid="GetValue" id="_ref_6"><a href="https://tc39.es/ecma262/#sec-getvalue">GetValue</a></emu-xref>(<var>argRef</var>).</li><li>Let <var>promiseCapability</var> be !&nbsp;<emu-xref aoid="NewPromiseCapability" id="_ref_7"><a href="https://tc39.es/ecma262/#sec-newpromisecapability">NewPromiseCapability</a></emu-xref>(<emu-xref href="#sec-promise-constructor"><a href="https://tc39.es/ecma262/#sec-promise-constructor">%Promise%</a></emu-xref>).</li><li>Let <var>specifierString</var> be <emu-xref aoid="ToString" id="_ref_8"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<var>specifier</var>).</li><li><emu-xref aoid="IfAbruptRejectPromise" id="_ref_9"><a href="https://tc39.es/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>specifierString</var>, <var>promiseCapability</var>).</li><li>Perform !&nbsp;<emu-xref aoid="HostImportModuleDynamically" id="_ref_10"><a href="#sec-hostimportmoduledynamically">HostImportModuleDynamically</a></emu-xref>(<var>referencingScriptOrModule</var>, <var>specifierString</var>, <ins><emu-val>undefined</emu-val>,</ins> <var>promiseCapability</var>).</li><li>Return <var>promiseCapability</var>.[[Promise]].
        </li></ol></emu-alg>

        <ins><emu-grammar><emu-production name="ImportCall" collapsed="">
    <emu-nt><a href="#prod-ImportCall">ImportCall</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="ee392673"><emu-t>import</emu-t><emu-t>(</emu-t><emu-nt><a href="https://tc39.es/ecma262/#prod-AssignmentExpression">AssignmentExpression</a></emu-nt><emu-t>,</emu-t><emu-nt><a href="https://tc39.es/ecma262/#prod-AssignmentExpression">AssignmentExpression</a></emu-nt><emu-t optional="">,<emu-mods><emu-opt>opt</emu-opt></emu-mods></emu-t><emu-t>)</emu-t></emu-rhs>
</emu-production></emu-grammar></ins>
        <emu-alg><ol><li>Let <var>referencingScriptOrModule</var> be !&nbsp;<emu-xref aoid="GetActiveScriptOrModule" id="_ref_11"><a href="https://tc39.es/ecma262/#sec-getactivescriptormodule">GetActiveScriptOrModule</a></emu-xref>().</li><li>Let <var>argRef</var> be the result of evaluating <ins>the first</ins> <emu-nt><a href="https://tc39.es/ecma262/#prod-AssignmentExpression">AssignmentExpression</a></emu-nt>.</li><li>Let <var>specifier</var> be ?&nbsp;<emu-xref aoid="GetValue" id="_ref_12"><a href="https://tc39.es/ecma262/#sec-getvalue">GetValue</a></emu-xref>(<var>argRef</var>).</li><li>Let <var>promiseCapability</var> be !&nbsp;<emu-xref aoid="NewPromiseCapability" id="_ref_13"><a href="https://tc39.es/ecma262/#sec-newpromisecapability">NewPromiseCapability</a></emu-xref>(<emu-xref href="#sec-promise-constructor"><a href="https://tc39.es/ecma262/#sec-promise-constructor">%Promise%</a></emu-xref>).</li><li>Let <var>specifierString</var> be <emu-xref aoid="ToString" id="_ref_14"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<var>specifier</var>).</li><li><emu-xref aoid="IfAbruptRejectPromise" id="_ref_15"><a href="https://tc39.es/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>specifierString</var>, <var>promiseCapability</var>).</li><li><ins>Let <var>argRef</var> be the result of evaluating the second <emu-nt><a href="https://tc39.es/ecma262/#prod-AssignmentExpression">AssignmentExpression</a></emu-nt>.</ins></li><li><ins>Let <var>arg</var> be ?&nbsp;<emu-xref aoid="GetValue" id="_ref_16"><a href="https://tc39.es/ecma262/#sec-getvalue">GetValue</a></emu-xref>(<var>argRef</var>).</ins></li><li><ins>If <var>arg</var> is <emu-val>undefined</emu-val>, let <var>attributes</var> be <emu-val>undefined</emu-val>.</ins></li><li><ins>Otherwise, let <var>attributes</var> be ?&nbsp;<emu-xref aoid="Get" id="_ref_17"><a href="https://tc39.es/ecma262/#sec-get-o-p">Get</a></emu-xref>(<var>arg</var>, <emu-val>"with"</emu-val>).</ins></li><li>Perform !&nbsp;<emu-xref aoid="HostImportModuleDynamically" id="_ref_18"><a href="#sec-hostimportmoduledynamically">HostImportModuleDynamically</a></emu-xref>(<var>referencingScriptOrModule</var>, <var>specifierString</var>, <ins><var>attributes</var>,</ins> <var>promiseCapability</var>).</li><li>Return <var>promiseCapability</var>.[[Promise]].
        </li></ol></emu-alg>
      </emu-clause>
    </emu-clause>

      <emu-clause id="sec-hostresolveimportedmodule" aoid="HostResolveImportedModule">
        <h1><span class="secnum">2.2</span> Runtime Semantics: HostResolveImportedModule ( <var>referencingScriptOrModule</var>, <var>specifier</var><ins>, <var>attributes</var></ins> )</h1>
        <p>HostResolveImportedModule is an implementation-defined abstract operation that provides the concrete <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> subclass instance that corresponds to the <emu-nt><a href="https://tc39.es/ecma262/#prod-ModuleSpecifier">ModuleSpecifier</a></emu-nt> String, <var>specifier</var>, occurring within the context of the script or module represented by the <emu-xref href="#script-record"><a href="https://tc39.es/ecma262/#script-record">Script Record</a></emu-xref> or <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> <var>referencingScriptOrModule</var>. <var>referencingScriptOrModule</var> may also be <emu-val>null</emu-val>, if the resolution is being performed in the context of an  <emu-xref href="#sec-import-calls" id="_ref_0"><a href="#sec-import-calls"><code>import()</code></a></emu-xref> expression, and there is no active script or module at that time.  <ins>The <var>attributes</var> parameter is an ECMAScript value representing the module attributes, originating either from an <code>import</code> statement or the second parameter of a dynamic <code>import()</code> expression. If no module attributes are provided, the value will be <emu-val>undefined</emu-val>.</ins></p>

        <emu-note><span class="note">Note</span><div class="note-contents">
          <p>An example of when <var>referencingScriptOrModule</var> can be <emu-val>null</emu-val> is in a web browser host. There, if a user clicks on a control given by</p>

          <pre><code class="html hljs"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"import('./foo.mjs')"</span>&gt;</span>Click me<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></code></pre>

          <p>there will be no active script or module at the time the  <emu-xref href="#sec-import-calls" id="_ref_1"><a href="#sec-import-calls"><code>import()</code></a></emu-xref> expression runs. More generally, this can happen in any situation where the host pushes execution contexts with <emu-val>null</emu-val> ScriptOrModule components onto the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref>.</p>
        </div></emu-note>

        <p>The implementation of HostResolveImportedModule must conform to the following requirements:</p>
        <ul>
          <li>
            The normal return value must be an instance of a concrete subclass of <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref>.
          
          </li>
          <li>
            If a <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> corresponding to the  <del>pair</del><ins>tuple</ins> <var>referencingScriptOrModule</var>, <var>specifier</var><ins>, _attributes</ins> does not exist or cannot be created, an exception must be thrown.
          
          </li>
          <li>
            Each time this operation is called with a specific <var>referencingScriptOrModule</var>, <var>specifier</var><ins>, <var>attributes</var></ins> <del>pair</del><ins>tuple</ins> as arguments it must return the same <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> instance if it completes normally.
          
          </li>
          <li>
            <ins>
              If <var>attributes</var> is not <emu-val>undefined</emu-val>, then the implementation of HostResolveImportModule must perform  <emu-alg><p>? <emu-xref aoid="Get" id="_ref_19"><a href="https://tc39.es/ecma262/#sec-get-o-p">Get</a></emu-xref>(<var>attributes</var>, <emu-val>"type"</emu-val>)</p></emu-alg>. Let <var>type</var> be the result. The following requirements apply:
              
              <ul>
                <li>If <var>type</var> is <emu-val>"json"</emu-val>, then this algorithm must either invoke <emu-xref aoid="ParseJSONModule" id="_ref_20"><a href="#sec-parse-json-module">ParseJSONModule</a></emu-xref> and return the resulting <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref>, or throw an exception.</li>
                <li>Each time this operation is called with a specific <var>referencingScriptOrModule</var>, <var>specifier</var>, <var>otherAttributes</var> tuple as arguments,  <em>if <var>otherAttributes</var> differs from <var>attributes</var> only based on the value of <var>type</var></em> it must return the same <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> instance if it completes normally.</li>
              </ul>
            </ins>
          </li>
          <li>
            <ins></ins>
          </li>
        </ul>
        <p>Multiple different <var>referencingScriptOrModule</var>, <var>specifier</var> pairs may map to the same <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> instance. The actual mapping semantic is implementation-defined but typically a normalization process is applied to <var>specifier</var> as part of the mapping process. A typical normalization process would include actions such as alphabetic case folding and expansion of relative and abbreviated path specifiers.</p>
      </emu-clause>

      <emu-clause id="sec-hostimportmoduledynamically" aoid="HostImportModuleDynamically">
        <h1><span class="secnum">2.3</span> Runtime Semantics: HostImportModuleDynamically ( <var>referencingScriptOrModule</var>, <var>specifier</var>,  <ins><var>attributes</var>,</ins> <var>promiseCapability</var> )</h1>
        <p>HostImportModuleDynamically is an implementation-defined abstract operation that performs any necessary setup work in order to make available the module corresponding to the <emu-nt><a href="https://tc39.es/ecma262/#prod-ModuleSpecifier">ModuleSpecifier</a></emu-nt> String, <var>specifier</var>, occurring within the context of the script or module represented by the <emu-xref href="#script-record"><a href="https://tc39.es/ecma262/#script-record">Script Record</a></emu-xref> or <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> <var>referencingScriptOrModule</var>,  <ins>with module attributes _attributes</ins>. (<var>referencingScriptOrModule</var> may also be <emu-val>null</emu-val>, if there is no active script or module when the  <emu-xref href="#sec-import-calls" id="_ref_2"><a href="#sec-import-calls"><code>import()</code></a></emu-xref> expression occurs.) It then performs <emu-xref aoid="FinishDynamicImport" id="_ref_21"><a href="#sec-finishdynamicimport">FinishDynamicImport</a></emu-xref> to finish the dynamic import process.</p>


        <p>The implementation of HostImportModuleDynamically must conform to the following requirements:</p>

        <ul>
          <li>
            The abstract operation must always complete normally with <emu-val>undefined</emu-val>. Success or failure must instead be signaled as discussed below.
          
          </li>
          <li>
            The host environment must conform to one of the two following sets of requirements:
            
            <dl>
              <dt>Success path</dt>

              <dd>
                <ul>
                  <li>At some future time, the host environment must perform <emu-xref aoid="FinishDynamicImport" id="_ref_22"><a href="#sec-finishdynamicimport">FinishDynamicImport</a></emu-xref>(<var>referencingScriptOrModule</var>, <var>specifier</var>,  <ins><var>attributes</var></ins>, <var>promiseCapability</var>, <emu-xref aoid="NormalCompletion" id="_ref_23"><a href="https://tc39.es/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<emu-val>undefined</emu-val>)).</li>

                  <li>Any subsequent call to <emu-xref aoid="HostResolveImportedModule" id="_ref_24"><a href="#sec-hostresolveimportedmodule">HostResolveImportedModule</a></emu-xref> after <emu-xref aoid="FinishDynamicImport" id="_ref_25"><a href="#sec-finishdynamicimport">FinishDynamicImport</a></emu-xref> has completed, given the arguments <var>referencingScriptOrModule</var>, <var>specifier</var>,  <ins>and <var>attributes</var></ins> must complete normally.</li>

                  <li>The completion value of any subsequent call to <emu-xref aoid="HostResolveImportedModule" id="_ref_26"><a href="#sec-hostresolveimportedmodule">HostResolveImportedModule</a></emu-xref> after <emu-xref aoid="FinishDynamicImport" id="_ref_27"><a href="#sec-finishdynamicimport">FinishDynamicImport</a></emu-xref> has completed, given the arguments <var>referencingScriptOrModule</var>, <var>specifier</var>,  <ins>and <var>attributes</var></ins> must be a module which has already been evaluated, i.e. whose Evaluate concrete method has already been called and returned a normal completion.</li>
                </ul>
              </dd>

              <dt>Failure path</dt>

              <dd>
                <ul>
                  <li>At some future time, the host environment must perform <emu-xref aoid="FinishDynamicImport" id="_ref_28"><a href="#sec-finishdynamicimport">FinishDynamicImport</a></emu-xref>(<var>referencingScriptOrModule</var>, <var>specifier</var>,  <ins><var>attributes</var>,</ins> <var>promiseCapability</var>, an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>), with the <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref> representing the cause of failure.</li>
                </ul>
              </dd>
            </dl>
          </li>
          <li>
            If the host environment takes the success path once for a given <var>referencingScriptOrModule</var>, <var>specifier</var><ins>, <var>attributes</var></ins> <del>pair</del><ins>tuple</ins>, it must always do so for subsequent calls.
          
          </li>
          <li>
            The operation must not call <var>promiseCapability</var>.[[Resolve]] or <var>promiseCapability</var>.[[Reject]], but instead must treat <var>promiseCapability</var> as an opaque identifying value to be passed through to <emu-xref aoid="FinishDynamicImport" id="_ref_29"><a href="#sec-finishdynamicimport">FinishDynamicImport</a></emu-xref>.
          
          </li>
        </ul>

        <p>The actual process performed is implementation-defined, but typically consists of performing whatever I/O operations are necessary to allow <emu-xref aoid="HostResolveImportedModule" id="_ref_30"><a href="#sec-hostresolveimportedmodule">HostResolveImportedModule</a></emu-xref> to synchronously retrieve the appropriate <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref>, and then calling its Evaluate concrete method. This might require performing similar normalization as <emu-xref aoid="HostResolveImportedModule" id="_ref_31"><a href="#sec-hostresolveimportedmodule">HostResolveImportedModule</a></emu-xref> does.</p>
      </emu-clause>

      <emu-clause id="sec-finishdynamicimport" aoid="FinishDynamicImport">
        <h1><span class="secnum">2.4</span> Runtime Semantics: FinishDynamicImport ( <var>referencingScriptOrModule</var>, <var>specifier</var>,  <ins><var>attributes</var>,</ins> <var>promiseCapability</var>, <var>completion</var> )</h1>
        <p>The abstract operation FinishDynamicImport takes arguments <var>referencingScriptOrModule</var>, <var>specifier</var>,  <ins><var>attributes</var>,</ins> <var>promiseCapability</var>, and <var>completion</var>. FinishDynamicImport completes the process of a dynamic import originally started by an  <emu-xref href="#sec-import-calls" id="_ref_3"><a href="#sec-import-calls"><code>import()</code></a></emu-xref> call, resolving or rejecting the promise returned by that call as appropriate according to <var>completion</var>. It is performed by host environments as part of <emu-xref aoid="HostImportModuleDynamically" id="_ref_32"><a href="#sec-hostimportmoduledynamically">HostImportModuleDynamically</a></emu-xref>. It performs the following steps when called:</p>


        <emu-alg><ol><li>If <var>completion</var> is an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, then perform !&nbsp;<emu-xref aoid="Call" id="_ref_33"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>promiseCapability</var>.[[Reject]], <emu-val>undefined</emu-val>, « <var>completion</var>.[[Value]] »).</li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>completion</var> is a normal completion and <var>completion</var>.[[Value]] is <emu-val>undefined</emu-val>.</li><li>Let <var>moduleRecord</var> be !&nbsp;<emu-xref aoid="HostResolveImportedModule" id="_ref_34"><a href="#sec-hostresolveimportedmodule">HostResolveImportedModule</a></emu-xref>(<var>referencingScriptOrModule</var>, <var>specifier</var><ins>, <var>attributes</var></ins>).</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: Evaluate has already been invoked on <var>moduleRecord</var> and successfully completed.</li><li>Let <var>namespace</var> be <emu-xref aoid="GetModuleNamespace" id="_ref_35"><a href="https://tc39.es/ecma262/#sec-getmodulenamespace">GetModuleNamespace</a></emu-xref>(<var>moduleRecord</var>).</li><li>If <var>namespace</var> is an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, perform !&nbsp;<emu-xref aoid="Call" id="_ref_36"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>promiseCapability</var>.[[Reject]], <emu-val>undefined</emu-val>, « <var>namespace</var>.[[Value]] »).</li><li>Else, perform !&nbsp;<emu-xref aoid="Call" id="_ref_37"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>promiseCapability</var>.[[Resolve]], <emu-val>undefined</emu-val>, « <var>namespace</var>.[[Value]] »).
        </li></ol></li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-synthetic-module-records">
        <h1><span class="secnum">2.5</span> Synthetic Module Records</h1>

        <emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">This Synthetic Module Records specification text comes from the  <a href="github.com/tc39/proposal-javascript-standard-library/">JavaScript Standard Library proposal</a> and was written by Domenic Denicola. A version of this text exists  <a href="https://heycam.github.io/webidl/#synthetic-module-records">in WebIDL</a>. A version of the text is copied here to clarify that the concept of Synthetic Module Records can proceed in standardization independently of the built-in modules effort.</div></emu-note>

        <p>A  <dfn>Synthetic Module Record</dfn> is used to represent information about a module that is defined by specifications. Its exports are derived from a pair of lists, of string keys and of ECMAScript values. The set of exported names is static, and determined at creation time (as an argument to <emu-xref aoid="CreateSyntheticModule" id="_ref_38"><a href="#sec-createsyntheticmodule">CreateSyntheticModule</a></emu-xref>), while the set of exported values can be changed over time using <emu-xref aoid="SetSyntheticModuleExport" id="_ref_39"><a href="#sec-setsyntheticmoduleexport">SetSyntheticModuleExport</a></emu-xref>. It has no imports or dependencies.</p>

        <emu-note><span class="note">Note</span><div class="note-contents">A Synthetic Module Record could be used for defining a variety of module types: for example, built-in modules, or JSON modules, or CSS modules.</div></emu-note>

        <p>In addition to the fields defined in  <emu-xref href="#table-36"><a href="https://tc39.es/ecma262/#table-36">Table 40</a></emu-xref>, Synthetic Module Records have the additional fields listed in  <emu-xref href="#table-synthetic-module-record-fields" id="_ref_4"><a href="#table-synthetic-module-record-fields">Table 1</a></emu-xref>. Each of these fields is initially set in <emu-xref aoid="CreateSyntheticModule" id="_ref_40"><a href="#sec-createsyntheticmodule">CreateSyntheticModule</a></emu-xref>.</p>

        <emu-table id="table-synthetic-module-record-fields" caption="Additional Fields of Synthetic Module Records"><figure><figcaption>Table 1: Additional Fields of Synthetic Module Records</figcaption>
          <table>
            <thead>
              <tr><th>Field Name
              
              </th><th>Value Type
              
              </th><th>Meaning
            
            </th></tr></thead>
            <tbody>
              <tr>
                <td>[[ExportNames]]
                
                </td><td><emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of String
                
                </td><td>A <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of all names that are exported.
              
              </td></tr>
              <tr>
                <td>[[EvaluationSteps]]
                
                </td><td>An abstract operation
                
                </td><td>An abstract operation that will be performed upon evaluation of the module, taking the <emu-xref href="#sec-synthetic-module-records" id="_ref_41"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref> as its sole argument. These will usually set up the exported values, by using <emu-xref aoid="SetSyntheticModuleExport" id="_ref_42"><a href="#sec-setsyntheticmoduleexport">SetSyntheticModuleExport</a></emu-xref>. They must not modify [[ExportNames]]. They may return an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>.
              
              </td></tr>
            </tbody>
          </table>
        </figure></emu-table>

        <emu-clause id="sec-createsyntheticmodule" aoid="CreateSyntheticModule">
          <h1><span class="secnum">2.5.1</span> CreateSyntheticModule ( <var>exportNames</var>, <var>evaluationSteps</var>, <var>realm</var>, <var>hostDefined</var> )</h1>

          <p>The abstract operation CreateSyntheticModule creates a <emu-xref href="#sec-synthetic-module-records" id="_ref_43"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref> based upon the given exported names and evaluation steps. It performs the following steps:</p>

          <emu-alg><ol><li>Return <emu-xref href="#sec-synthetic-module-records" id="_ref_44"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref> { [[Realm]]: <var>realm</var>, [[Environment]]: <emu-val>undefined</emu-val>, [[Namespace]]: <emu-val>undefined</emu-val>, [[HostDefined]]: <var>hostDefined</var>, [[ExportNames]]: <var>exportNames</var>, [[EvaluationSteps]]: <var>evaluationSteps</var> }.
          </li></ol></emu-alg>

          <emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">It seems we could set up the environment either here or in Instantiate(). I've chosen to do so in Instantiate() for symmetry with Source Text Module Records, but I don't think there's any actual requirement in that regard.</div></emu-note>
        </emu-clause>

        <emu-clause id="sec-setsyntheticmoduleexport" aoid="SetSyntheticModuleExport">
          <h1><span class="secnum">2.5.2</span> SetSyntheticModuleExport ( <var>module</var>, <var>exportName</var>, <var>exportValue</var> )</h1>

          <p>The abstract operation SetSyntheticModuleExport can be used to set or change the exported value for a pre-established export of a <emu-xref href="#sec-synthetic-module-records" id="_ref_45"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref>. It performs the following steps:</p>

          <emu-alg><ol><li>Let <var>envRec</var> be <var>module</var>.[[Environment]]'s <emu-xref href="#sec-lexical-environments"><a href="https://tc39.es/ecma262/#sec-lexical-environments">EnvironmentRecord</a></emu-xref>.</li><li>Perform <var>envRec</var>.SetMutableBinding(<var>exportName</var>, <var>exportValue</var>, <emu-val>true</emu-val>).
          </li></ol></emu-alg>
        </emu-clause>

        <emu-clause id="sec-smr-concrete-methods">
          <h1><span class="secnum">2.5.3</span> Concrete Methods</h1>

          <p>The following are the concrete methods for <emu-xref href="#sec-synthetic-module-records" id="_ref_46"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref> that implement the corresponding <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> abstract methods.</p>

          <emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">I find having this wrapping sub-clause cleaner and suggest we do the same for Source Text Module Records in the main spec.</div></emu-note>

          <emu-clause id="sec-smr-getexportednames">
            <h1><span class="secnum">2.5.3.1</span> GetExportedNames( <var>exportStarSet</var> )</h1>

            <p>The GetExportedNames concrete method of a <emu-xref href="#sec-synthetic-module-records" id="_ref_47"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref> implements the corresponding <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> abstract method.</p>
            <p>It performs the following steps:</p>

            <emu-alg><ol><li>Let <var>module</var> be this <emu-xref href="#sec-synthetic-module-records" id="_ref_48"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref>.</li><li>Return <var>module</var>.[[ExportNames]].
            </li></ol></emu-alg>
          </emu-clause>

          <emu-clause id="sec-smr-resolveexport">
            <h1><span class="secnum">2.5.3.2</span> ResolveExport( <var>exportName</var>, <var>resolveSet</var> )</h1>

            <p>The ResolveExport concrete method of a <emu-xref href="#sec-synthetic-module-records" id="_ref_49"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref> implements the corresponding <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> abstract method.</p>
            <p>It performs the following steps:</p>

            <emu-alg><ol><li>Let <var>module</var> be this <emu-xref href="#sec-synthetic-module-records" id="_ref_50"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref>.</li><li>If <var>module</var>.[[ExportNames]] does not contain <var>exportName</var>, return null.</li><li>Return <emu-xref href="#resolvedbinding-record"><a href="https://tc39.es/ecma262/#resolvedbinding-record">ResolvedBinding Record</a></emu-xref> { [[Module]]: <var>module</var>, [[BindingName]]: <var>exportName</var> }.
            </li></ol></emu-alg>
          </emu-clause>

          <emu-clause id="sec-smr-instantiate">
            <h1><span class="secnum">2.5.3.3</span> Instantiate ( )</h1>

            <p>The Instantiate concrete method of a <emu-xref href="#sec-synthetic-module-records" id="_ref_51"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref> implements the corresponding <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> abstract method.</p>
            <p>It performs the following steps:</p>

            <emu-alg><ol><li>Let <var>module</var> be this <emu-xref href="#sec-synthetic-module-records" id="_ref_52"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref>.</li><li>Let <var>realm</var> be <var>module</var>.[[Realm]].</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>realm</var> is not <emu-val>undefined</emu-val>.</li><li>Let <var>env</var> be <emu-xref aoid="NewModuleEnvironment" id="_ref_53"><a href="https://tc39.es/ecma262/#sec-newmoduleenvironment">NewModuleEnvironment</a></emu-xref>(<var>realm</var>.[[GlobalEnv]]).</li><li>Set <var>module</var>.[[Environment]] to <var>env</var>.</li><li>Let <var>envRec</var> be <var>env</var>'s <emu-xref href="#sec-lexical-environments"><a href="https://tc39.es/ecma262/#sec-lexical-environments">EnvironmentRecord</a></emu-xref>.</li><li>For each <var>exportName</var> in <var>module</var>.[[ExportNames]],</li><li>Perform ! <var>envRec</var>.CreateMutableBinding(<var>exportName</var>, <emu-val>false</emu-val>).</li><li>Perform ! <var>envRec</var>.InitializeBinding(<var>exportName</var>, <emu-val>undefined</emu-val>).</li><li>Return <emu-val>undefined</emu-val>.
            </li></ol></emu-alg>
          </emu-clause>

          <emu-clause id="sec-smr-Evaluate">
            <h1><span class="secnum">2.5.3.4</span> Evaluate ( )</h1>

            <p>The Evaluate concrete method of a <emu-xref href="#sec-synthetic-module-records" id="_ref_54"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref> implements the corresponding <emu-xref href="#sec-abstract-module-records"><a href="https://tc39.es/ecma262/#sec-abstract-module-records">Module Record</a></emu-xref> abstract method.</p>
            <p>It performs the following steps:</p>

            <emu-alg><ol><li>Let <var>module</var> be this <emu-xref href="#sec-synthetic-module-records" id="_ref_55"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref>.</li><li>Let <var>moduleCxt</var> be a new ECMAScript code <emu-xref href="#sec-execution-contexts"><a href="https://tc39.es/ecma262/#sec-execution-contexts">execution context</a></emu-xref>.</li><li>Set the Function of <var>moduleCxt</var> to <emu-val>null</emu-val>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>module</var>.[[Realm]] is not <emu-val>undefined</emu-val>.</li><li>Set the <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> of <var>moduleCxt</var> to <var>module</var>.[[Realm]].</li><li>Set the ScriptOrModule of <var>moduleCxt</var> to <var>module</var>.</li><li>Set the VariableEnvironment of <var>moduleCxt</var> to <var>module</var>.[[Environment]].</li><li>Set the LexicalEnvironment of <var>moduleCxt</var> to <var>module</var>.[[Environment]].</li><li><emu-xref aoid="Suspend" id="_ref_56"><a href="https://tc39.es/ecma262/#sec-suspend">Suspend</a></emu-xref> the currently <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Push <var>moduleCxt</var> on to the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref>; <var>moduleCxt</var> is now the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Let <var>result</var> be the result of performing ? <var>module</var>.[[EvaluationSteps]](<var>module</var>).</li><li><emu-xref aoid="Suspend" id="_ref_57"><a href="https://tc39.es/ecma262/#sec-suspend">Suspend</a></emu-xref> <var>moduleCxt</var> and remove it from the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref>.</li><li>Resume the context that is now on the top of the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref> as the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Return <emu-xref aoid="Completion" id="_ref_58"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">Completion</a></emu-xref>(<var>result</var>).
            </li></ol></emu-alg>
          </emu-clause>
        </emu-clause>
      </emu-clause>

  <emu-clause id="sec-create-default-export-synthetic-module" aoid="CreateDefaultExportSyntheticModule">
    <h1><span class="secnum">2.6</span> CreateDefaultExportSyntheticModule ( <var>defaultExport</var> )</h1>
    <p>The CreateDefaultExportSyntheticModule abstract operation creates a <emu-xref href="#sec-synthetic-module-records" id="_ref_59"><a href="#sec-synthetic-module-records">Synthetic Module Record</a></emu-xref> whose default export is <var>defaultExport</var>. It performs the following steps:</p>
    <emu-alg><ol><li>Return <emu-xref aoid="CreateSyntheticModule" id="_ref_60"><a href="#sec-createsyntheticmodule">CreateSyntheticModule</a></emu-xref>(« <emu-val>"default"</emu-val> », the following steps, the current <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref>, <var>defaultExport</var>) with the following steps given <var>module</var> as an argument:<p></p><ol><li><emu-xref aoid="SetSyntheticModuleExport" id="_ref_61"><a href="#sec-setsyntheticmoduleexport">SetSyntheticModuleExport</a></emu-xref>(<var>module</var>, <emu-val>"default"</emu-val>, <var>module</var>.[[HostDefined]]).
    </li></ol></li></ol></emu-alg>
    <!-- TODO: Could we apply the new spec closure concept here rather than painstakingly passing _defaultExport_ through [[HostDefined]]? -->
  </emu-clause>

  <emu-clause id="sec-parse-json-module" aoid="ParseJSONModule">
    <h1><span class="secnum">2.7</span> ParseJSONModule ( <var>source</var> )</h1>
    <p>The abstract operation ParseJSONModule takes a single argument <var>source</var> which is a String representing the contents of a module.</p>

    <emu-alg><ol><li>Let <var>json</var> be ?&nbsp;<emu-xref aoid="Call" id="_ref_62"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<emu-xref href="#sec-json.parse"><a href="https://tc39.es/ecma262/#sec-json.parse">%JSONParse%</a></emu-xref>, <emu-val>undefined</emu-val>, « <var>source</var> »).  <!-- TODO: Refactor JSONParse into an abstract algorithm --></li><li>Return <emu-xref aoid="CreateDefaultExportSyntheticModule" id="_ref_63"><a href="#sec-create-default-export-synthetic-module">CreateDefaultExportSyntheticModule</a></emu-xref>(<var>json</var>).
    </li></ol></emu-alg>
  </emu-clause>

  <h1>TODO</h1>
  <ul>
    <li>There's a parse-time algorithm which converts WithClause into a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of Attribute Records of the form { [[AttributeKey]]: String, [[AttributeValue]]: String }, and similarly, a runtime algorithm for dynamically created attributes passed through <code>import()</code>.</li>
    <li>RequestedModules becomes a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of Records of the form { [[Specifier]]: String, [[Attributes]]: <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of Attribute Records }.</li>
    <li>Update the RequestedModules algorithm to calculate it correctly.</li>
    <li>Update <emu-xref aoid="InnerModuleLinking" id="_ref_64"><a href="https://tc39.es/ecma262/#sec-InnerModuleLinking">InnerModuleLinking</a></emu-xref> and <emu-xref aoid="InnerModuleEvaluation" id="_ref_65"><a href="https://tc39.es/ecma262/#sec-innermoduleevaluation">InnerModuleEvaluation</a></emu-xref> to pass both the specifier and attributes from [[RequestedModules]] records up to <emu-xref aoid="HostResolveImportedModule" id="_ref_66"><a href="#sec-hostresolveimportedmodule">HostResolveImportedModule</a></emu-xref>.</li>
    <li>Update most other callsites of <emu-xref aoid="HostResolveImportedModule" id="_ref_67"><a href="#sec-hostresolveimportedmodule">HostResolveImportedModule</a></emu-xref>, where the attributes are not so readily available, to search through [[RequestedModules]] to find the attribute value (or, to pass up a don't-care-sentinel).</li>
  </ul>
</emu-clause>

<emu-annex id="sec-host-integration">
  <h1><span class="secnum">A</span> Sample host integration: The Web embedding</h1>

  <p>The module attributes proposal is intended to give key information about how modules are interpreted to hosts. For the Web embedding and environments which aim to be similar to it, the string is interpreted as the "module type". This is not the primary way the module type is determined (which, on the Web, would be the MIME type, and in other environments may be the file extension), but rather a secondary check which is required to pass for the module graph to load.</p>

  <p>In the Web embedding, the following changes would be made to the HTML specification for module attributes:</p>

  <ul>
    <li>The  <a href="https://html.spec.whatwg.org/#module-script">module script</a> would have an additional item, which would be the module type, as a string (e.g., <emu-val>"json"</emu-val>), or <emu-val>undefined</emu-val> for a JavaScript module.</li>
    <li><emu-xref aoid="HostResolveImportedModule" id="_ref_68"><a href="#sec-hostresolveimportedmodule">HostResolveImportedModule</a></emu-xref> and <emu-xref aoid="HostImportModuleDynamically" id="_ref_69"><a href="#sec-hostimportmoduledynamically">HostImportModuleDynamically</a></emu-xref> would take an extra <var>attributes</var> parameter, which would be passed down through several <emu-xref href="#sec-algorithm-conventions-abstract-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-abstract-operations">abstract operations</a></emu-xref> to reach the  <a href="https://html.spec.whatwg.org/#fetch-a-single-module-script">fetch a single module script</a> algorithm. Somewhere near the entrypoint, if <var>attributes</var> is not <emu-val>undefined</emu-val>, then let <var>type</var> be ? <emu-xref aoid="Get" id="_ref_70"><a href="https://tc39.es/ecma262/#sec-get-o-p">Get</a></emu-xref>(<var>attributes</var>, <emu-val>"type"</emu-val>); otherwise let <var>type</var> be <emu-val>undefined</emu-val>. If the type is invalid, then an exception is thrown and module loading fails. Otherwise, this will equal the module type, if the module can be successfully fetched with a matching MIME type.</li>
    <li>In the  <a href="https://html.spec.whatwg.org/#fetch-the-descendants-of-a-module-script">fetch the descendents of a module script</a> algorithm, when iterating over [[RequestedModules]], the attribute is saved in parallel with module URLs, and passed on to the internal module script graph fetching procedure (which sends it to "fetch a single module script". Other usage sites of [[RequestedModules]] ignore the attribute.</li>
    <li>"Fetch a single module script" would check the attribute in two places:
      
      <ul>
        <li>If the module is found in the module map, then <var>type</var> is checked against he module script's type field. If they differ, then an exception is thrown and module loading fails.</li>
        <li>When a new module is fetched, before writing it into the module map, the MIME type is checked to ensure that it matches <var>type</var>. (Note that the interpretation of the module is still driven by the MIME type, but once the MIME type is established, this is checked against the <var>type</var>.) If they differ, then an exception is thrown and module loading fails. The <var>type</var> is written into the module script as the type.</li>
      </ul>
    </li>
  </ul>

  <p>Note that the module map remains keyed by the absolute URL; the <var>type</var> is not part of the module map key, and initially, no other module attributes are supported, so they are also not present.</p>
</emu-annex>
</div></body>